<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="icon" href="data:,">
<meta charset="UTF-8">
<title>ê´€ë¦¬ì í˜ì´ì§€</title>

<style>
body{font-family:Arial;padding:30px;background:#f5f5f5;}
h1{margin-bottom:20px;}
h2{margin-top:40px;}

input{
  width:100%;
  height:36px;
  margin-bottom:8px;
  padding:0 8px;
  box-sizing:border-box;
}

button{
  height:38px;
  padding:0 15px;
  border:none;
  border-radius:6px;
  background:#87CEEB;
  color:#fff;
  cursor:pointer;
}

button:hover{background:#6bbfe0;}

.section{margin-bottom:30px;}

.save-btn{
  width:240px;
  height:45px;
  font-size:16px;
  margin:40px auto;
  display:block;
}
</style>
</head>

<body>

<h1>ê´€ë¦¬ì í˜ì´ì§€</h1>

<!-- ===== ë°°ë„ˆ ===== -->
<div class="section">
<h2>ìƒë‹¨ ë°°ë„ˆ</h2>
<input id="bannerImg" placeholder="ë°°ë„ˆ ì´ë¯¸ì§€ URL">
<input id="bannerLink" placeholder="ë°°ë„ˆ í´ë¦­ ë§í¬">
</div>

<!-- ===== ì†Œìœ ì & SNS ===== -->

<div class="section owner-admin">
<h2>ì†Œìœ ì & SNS ê´€ë¦¬</h2>
<input id="ownerName" placeholder="ì†Œìœ ì ì´ë¦„">
<input id="instagram" placeholder="Instagram ë§í¬">
<input id="youtube" placeholder="YouTube ë§í¬">
<input id="facebook" placeholder="Facebook ë§í¬">
<input id="twitter" placeholder="X(íŠ¸ìœ„í„°) ë§í¬">
</div>

<button class="save-btn" onclick="saveAll()">ì €ì¥í•˜ê¸°</button>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<script>

/* ===== ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ===== */

async function loadData(){

  const { data, error } = await supabaseClient
    .from("site_settings")
    .select("*")
    .eq("id",1)
    .maybeSingle();

  if(error){
    console.error("ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:",error);
    return;
  }

  if(data){
    bannerImg.value=data.banner_img||"";
    bannerLink.value=data.banner_link||"";
    ownerName.value=data.owner_name||"";
    instagram.value=data.instagram||"";
    youtube.value=data.youtube||"";
    facebook.value=data.facebook||"";
    twitter.value=data.twitter||"";
  }
}

/* ===== ì €ì¥ ===== */

async function saveAll(){

  /* =========================
     1ï¸âƒ£ ë°°ë„ˆ + ì†Œìœ ì + SNS ì €ì¥
     ========================= */

  const payload = {
    banner_img: bannerImg.value.trim(),
    banner_link: bannerLink.value.trim(),
    owner_name: ownerName.value.trim(),
    instagram: instagram.value.trim(),
    youtube: youtube.value.trim(),
    facebook: facebook.value.trim(),
    twitter: twitter.value.trim()
  };

  try {

    // id=1 ì¡´ì¬ í™•ì¸
const { data: existing, error: selectError } = await supabaseClient
  .from("site_settings")
  .select("id")
  .eq("id", 1)
  .maybeSingle();

    if(selectError && selectError.code !== "PGRST116"){
      console.error("select ì˜¤ë¥˜:", selectError);
    }

    if (existing) {
      // ìˆìœ¼ë©´ update
      const { error: updateError } = await supabaseClient
        .from("site_settings")
        .update(payload)
        .eq("id", 1);

      if(updateError){
        console.error("update ì˜¤ë¥˜:", updateError);
        alert("ì„¤ì • ì €ì¥ ì‹¤íŒ¨");
        return;
      }

    } else {
      // ì—†ìœ¼ë©´ insert
      const { error: insertError } = await supabaseClient
        .from("site_settings")
        .insert([{ id:1, ...payload }]);

      if(insertError){
        console.error("insert ì˜¤ë¥˜:", insertError);
        alert("ì„¤ì • ì €ì¥ ì‹¤íŒ¨");
        return;
      }
    }

  } catch(e){
    console.error("site_settings ì €ì¥ ì¤‘ ì˜ˆì™¸:", e);
    alert("ì„¤ì • ì €ì¥ ì‹¤íŒ¨");
    return;
  }


  /* =========================
     2ï¸âƒ£ ê¸°ì¡´ ê´‘ê³  ì €ì¥ ë¡œì§
     ========================= */
  // ğŸ”¥ ì´ ì•„ë˜ ê´‘ê³  ì €ì¥ ë¶€ë¶„ì€
  // ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ë‘ì„¸ìš”
  // (ì—¬ê¸° ìˆ˜ì •í•˜ì§€ ë§ˆì„¸ìš”)

  alert("ì €ì¥ ì™„ë£Œ âœ…");
}

loadData();

</script>

</body>
</html>