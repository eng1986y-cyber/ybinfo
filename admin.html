<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê´€ë¦¬ì í˜ì´ì§€</title>
<style>
body {
  font-family:Arial;
  padding:20px;
  background:#f5f5f5;
}

/* ì „ì²´ ì»¨í…Œì´ë„ˆ */
.container {
  max-width:1000px;   /* ë¸Œë¼ìš°ì € ì»¤ì ¸ë„ ì´ ì´ìƒ ì•ˆ ëŠ˜ì–´ë‚¨ */
  margin:0 auto;
}

/* ë¡œê·¸ì¸ ë°•ìŠ¤ */
.login {
  max-width:300px;
  margin:60px auto;
}

/* ì…ë ¥ & ë²„íŠ¼ ì‚¬ì´ì¦ˆ ì¶•ì†Œ */
input {
  width:100%;
  padding:6px;
  margin-bottom:8px;
  font-size:13px;
}

button {
  padding:8px;
  width:100%;
  font-size:13px;
}

/* ê´‘ê³  ê·¸ë¦¬ë“œ */
.grid {
  display:grid;
  grid-template-columns:repeat(6, 1fr);
  gap:8px;
}

/* êµ¬ë¶„ì„  */
hr {
  margin:25px 0;
}

.hidden {
  display:none;
}
hr { margin:30px 0; }

/* ë¡œê·¸ì¸ ì…ë ¥ ê³µí†µ */
.login input {
  width:100%;
  padding:10px;
  margin-bottom:10px;
  box-sizing:border-box;
}

/* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ë€ ì™€ì¸ìƒ‰ í…Œë‘ë¦¬ */
#loginPw {
  border:2px solid #722f37; /* ì™€ì¸ìƒ‰ */
}

/* ë¡œê·¸ì¸ ë²„íŠ¼ ì™€ì¸ìƒ‰ */
.login-btn {
  background:#722f37;
  color:#fff;
  border:none;
  padding:12px;
  width:100%;
  cursor:pointer;
}

.login-btn:hover {
  background:#5a232a;
}

/* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜ì—­ */
.pw-box {
  width:50%;
  margin:0 auto;
}

/* ì…ë ¥ë€ + ë²„íŠ¼ ì™„ì „ ë™ì¼ ì‚¬ì´ì¦ˆ */
.pw-box input,
.pw-box button {
  width:100%;
  height:36px;        /* â† ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ë†’ì´ ë™ì¼ */
  padding:6px;
  font-size:13px;
  box-sizing:border-box;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ë§Œ ìƒ‰ìƒ ì ìš© */
.pw-box button {
  background:#722f37;   /* ì™€ì¸ìƒ‰ */
  color:#fff;
  border:none;
  cursor:pointer;
}

.pw-box button:hover {
  background:#5a232a;
}

/* ì €ì¥ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.save-btn {
  width:20%;          /* 20%ë¡œ ì¶•ì†Œ */
  margin:20px auto;   /* ê°€ìš´ë° ì •ë ¬ */
  display:block;
  padding:10px;
  font-size:12px;
}
</style>
</head>
<body>

<div class="login" id="loginBox">
  <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
  <input type="text" id="loginId" placeholder="ì•„ì´ë””">
  <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button class="login-btn" onclick="login()">ë¡œê·¸ì¸</button>
</div>

<div id="adminBox" class="hidden">
  <div class="container">

<h2>ìƒë‹¨ ë°°ë„ˆ ê´€ë¦¬</h2>
<input id="bannerImg" placeholder="ë°°ë„ˆ ì´ë¯¸ì§€ URL">
<input id="bannerLink" placeholder="ë°°ë„ˆ í´ë¦­ ë§í¬">
<hr>

    <h2>ì´ë¯¸ì§€ ê´‘ê³  ê´€ë¦¬</h2>
    <div class="grid" id="imageAdmin"></div>

    <h2 style="margin-top:30px;">í…ìŠ¤íŠ¸ ê´‘ê³  ê´€ë¦¬</h2>
    <div class="grid" id="textAdmin"></div>

<button class="save-btn" onclick="save()">ì €ì¥</button>

<h3>ì‚¬ì´íŠ¸ ì†Œìœ ì ì„¤ì •</h3>
<input id="ownerName" placeholder="ì‚¬ì´íŠ¸ ì†Œìœ ì ì´ë¦„ ì…ë ¥">

    <hr>

    <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë§¨ ì•„ë˜ -->
<div class="pw-box">
  <h3>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
  <input type="password" id="oldPw" placeholder="ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸">
  <input type="password" id="newPw" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸">
  <button onclick="changePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<script>

// ğŸ” ë¡œê·¸ì¸
async function login(){

  const email = loginId.value;
  const password = loginPw.value;

  const { data, error } =
    await supabaseClient.auth.signInWithPassword({
      email,
      password
    });

  if(error){
    alert("ë¡œê·¸ì¸ ì‹¤íŒ¨");
    console.log(error);
    return;
  }

  console.log("ë¡œê·¸ì¸ ì„±ê³µ:", data);

  loginBox.style.display="none";
  adminBox.style.display="block";

  loadData();
}

// ğŸ” ë¡œê·¸ì¸ ìœ ì§€
supabaseClient.auth.onAuthStateChange((event, session) => {
  if (session) {
    console.log("ì„¸ì…˜ ìœ ì§€ë¨");
  }
});

// ğŸ“¥ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadData(){

  // ê´‘ê³  ë¶ˆëŸ¬ì˜¤ê¸°
  const { data: ads } = await supabaseClient
    .from("ads")
    .select("*")
    .order("id",{ascending:true});

  imageAdmin.innerHTML="";
  textAdmin.innerHTML="";

  ads.forEach(ad=>{

    if(ad.type==="image"){
      const div=document.createElement("div");
      div.innerHTML=`
        <input value="${ad.image_url}" placeholder="ì´ë¯¸ì§€ URL">
        <input value="${ad.link_url}" placeholder="í´ë¦­ ë§í¬">
      `;
      imageAdmin.appendChild(div);
    }

    if(ad.type==="text"){
      const div=document.createElement("div");
      div.innerHTML=`
        <input value="${ad.title}" placeholder="í…ìŠ¤íŠ¸">
        <input value="${ad.link_url}" placeholder="í´ë¦­ ë§í¬">
      `;
      textAdmin.appendChild(div);
    }

  });

  // ì‚¬ì´íŠ¸ ì„¤ì •
  const { data: settings } = await supabaseClient
    .from("site_settings")
    .select("*")
    .limit(1);

  if(settings.length>0){
    bannerImg.value = settings[0].banner_img || "";
    bannerLink.value = settings[0].banner_link || "";
    ownerName.value = settings[0].owner_name || "";
  }
}

// ğŸ’¾ ì €ì¥
async function save(){

  // ê´‘ê³  ì „ì²´ ì‚­ì œ
  await supabaseClient.from("ads").delete().neq("id",0);

  // ì´ë¯¸ì§€ ê´‘ê³  ì €ì¥
  const imgInputs=imageAdmin.querySelectorAll("input");
  for(let i=0;i<imgInputs.length;i+=2){

    const img=imgInputs[i].value.trim();
    const link=imgInputs[i+1].value.trim();

    if(img){
      await supabaseClient.from("ads").insert([{
        type:"image",
        title:"",
        image_url:img,
        link_url:link
      }]);
    }
  }

  // í…ìŠ¤íŠ¸ ê´‘ê³  ì €ì¥
  const txtInputs=textAdmin.querySelectorAll("input");
  for(let i=0;i<txtInputs.length;i+=2){

    const text=txtInputs[i].value.trim();
    const link=txtInputs[i+1].value.trim();

    if(text){
      await supabaseClient.from("ads").insert([{
        type:"text",
        title:text,
        image_url:"",
        link_url:link
      }]);
    }
  }

  // ì‚¬ì´íŠ¸ ì„¤ì • ì €ì¥
  await supabaseClient.from("site_settings")
    .delete().neq("id",0);

  await supabaseClient.from("site_settings").insert([{
    banner_img: bannerImg.value.trim(),
    banner_link: bannerLink.value.trim(),
    owner_name: ownerName.value.trim()
  }]);

  alert("ì €ì¥ ì™„ë£Œ");
}

</script>

</body>
</html>
