<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>관리자 페이지</title>

<style>
body{font-family:Arial;padding:30px;background:#f5f5f5;}
h1{margin-bottom:20px;}
h2{margin-top:40px;}

input,select{
  width:100%;
  height:36px;
  margin-bottom:8px;
  padding:0 8px;
}

button{
  height:40px;
  padding:0 20px;
  border:none;
  background:#87CEEB;
  color:#fff;
  cursor:pointer;
  border-radius:6px;
}

.section{
  background:#fff;
  padding:20px;
  border-radius:10px;
  margin-bottom:30px;
  border:1px solid #ddd;
}

.ad-item{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
  background:#fafafa;
  padding:8px;
  border-radius:6px;
  font-size:14px;
}
.delete-btn{
  background:#ff6b6b;
  height:28px;
}
</style>
</head>

<body>

<h1>관리자 페이지</h1>

<div class="section">
<h2>광고 추가</h2>

<select id="adType">
  <option value="image">상단 이미지 광고</option>
  <option value="text">텍스트 광고</option>
  <option value="square">정방형 광고</option>
</select>

<input id="title" placeholder="텍스트광고 제목 (text용)">
<input id="image_url" placeholder="이미지 주소">
<input id="link_url" placeholder="링크 주소 (선택)">
<input id="popup_url" placeholder="팝업 이미지 주소 (square 전용)">

<button onclick="addAd()">광고 저장</button>
</div>

<div class="section">
<h2>광고 목록</h2>
<div id="adList"></div>
</div>

<div class="section">
<h2>배너 & 소유자 설정</h2>

<input id="banner_img" placeholder="배너 이미지 주소">
<input id="banner_link" placeholder="배너 링크">

<input id="owner_name" placeholder="소유자 이름">
<input id="owner_instagram" placeholder="인스타그램 링크">
<input id="owner_youtube" placeholder="유튜브 링크">
<input id="owner_blog" placeholder="블로그 링크">

<button onclick="saveSettings()">설정 저장</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<script>

async function addAd(){
  const type=adType.value;
  const titleVal=title.value;
  const imageVal=image_url.value;
  const linkVal=link_url.value;
  const popupVal=popup_url.value;

  await supabaseClient.from("ads").insert([{
    type:type,
    title:titleVal,
    image_url:imageVal,
    link_url:linkVal,
    popup_url:popupVal
  }]);

  alert("저장 완료");
  loadAds();
}

async function loadAds(){
  const { data } = await supabaseClient.from("ads").select("*").order("id");
  adList.innerHTML="";

  data?.forEach(ad=>{
    adList.innerHTML+=`
      <div class="ad-item">
        <div>${ad.id} | ${ad.type}</div>
        <button class="delete-btn"
          onclick="deleteAd(${ad.id})">삭제</button>
      </div>`;
  });
}

async function deleteAd(id){
  if(!confirm("삭제할까요?")) return;
  await supabaseClient.from("ads").delete().eq("id",id);
  loadAds();
}

async function saveSettings(){

  await supabaseClient.from("site_settings")
    .upsert([{
      id:1,
      banner_img:banner_img.value,
      banner_link:banner_link.value,
      owner_name:owner_name.value,
      owner_instagram:owner_instagram.value,
      owner_youtube:owner_youtube.value,
      owner_blog:owner_blog.value
    }]);

  alert("설정 저장 완료");
}

loadAds();

</script>
</body>
</html>